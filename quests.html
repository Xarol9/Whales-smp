<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALE | QUANTUM QUEST LOG</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        :root {
            --quest-cyan: #00f2ff;
            --quest-gold: #ffcc00;
            --quest-red: #ff0044;
            --quest-bg: #01030a;
            --quest-panel: rgba(10, 15, 30, 0.95);
            --quest-border: rgba(0, 242, 255, 0.2);
        }

        /* Базові стилі та курсор */
        * { margin: 0; padding: 0; box-sizing: border-box; cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="4" fill="%2300f2ff"/><line x1="16" y1="0" x2="16" y2="10" stroke="%2300f2ff" stroke-width="1"/><line x1="0" y1="16" x2="10" y2="16" stroke="%2300f2ff" stroke-width="1"/><line x1="16" y1="32" x2="16" y2="22" stroke="%2300f2ff" stroke-width="1"/><line x1="32" y1="16" x2="22" y2="16" stroke="%2300f2ff" stroke-width="1"/></svg>') 16 16, auto; }
        
        body { 
            background: var(--quest-bg);
            color: #fff;
            font-family: 'Share Tech Mono', monospace;
            height: 100vh;
            overflow: hidden;
            background-image: radial-gradient(circle at center, rgba(0,242,255,0.02) 0%, transparent 70%);
        }

        /* Фонова сітка з ефектом глибини */
        #grid-3d-canvas {
            position: fixed; inset: 0; z-index: -1; opacity: 0.1;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        /* Головний контейнер */
        .quest-terminal {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            grid-template-rows: 70px 1fr;
            height: 100vh;
            gap: 25px;
            padding: 25px;
        }

        /* Хедер (Інфо-панель) */
        header {
            grid-column: 1 / 4;
            background: var(--quest-panel);
            border: 1px solid var(--quest-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.6);
        }

        .sys-info {
            font-family: 'Syncopate', sans-serif;
            font-size: 0.7rem;
            color: var(--quest-cyan);
            letter-spacing: 2px;
        }

        .sys-clock {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            color: #fff;
            letter-spacing: 1px;
        }

        /* Бічна панель (Навігація/Фільтри) */
        .sidebar-panel {
            background: var(--quest-panel);
            border: 1px solid var(--quest-border);
            padding: 30px;
            display: flex;
            flex-direction: column;
        }

        .nav-category {
            padding: 18px;
            margin-bottom: 10px;
            border-left: 3px solid transparent;
            color: rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
            font-weight: 500;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .nav-category:hover {
            background: rgba(0, 242, 255, 0.05);
            color: #fff;
        }

        .nav-category.active {
            color: var(--quest-cyan);
            border-left-color: var(--quest-cyan);
            background: rgba(0, 242, 255, 0.1);
        }

        /* Центральна зона (Список Квестів) */
        .quest-log-feed {
            overflow-y: auto;
            padding-right: 15px;
            scroll-behavior: smooth;
        }

        .quest-log-feed::-webkit-scrollbar { width: 3px; }
        .quest-log-feed::-webkit-scrollbar-thumb { background: var(--quest-cyan); }

        .quest-entry {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--quest-border);
            padding: 35px;
            margin-bottom: 20px;
            position: relative;
            transition: all 0.4s cubic-bezier(0.2, 1, 0.2, 1);
            animation: slideInQuest 0.6s ease forwards;
        }

        .quest-entry:hover {
            border-color: var(--quest-cyan);
            background: rgba(0, 242, 255, 0.04);
            transform: scale(1.005);
            box-shadow: 0 0 25px rgba(0,242,255,0.1);
        }

        @keyframes slideInQuest { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .quest-id { font-size: 0.6rem; color: var(--quest-cyan); opacity: 0.7; }
        .quest-title { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; margin: 10px 0; color: #fff; }
        .quest-description { font-size: 0.9rem; color: rgba(255, 255, 255, 0.6); line-height: 1.7; }

        .quest-footer {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reward-info {
            font-family: 'Orbitron', sans-serif;
            color: var(--quest-gold);
            font-weight: 700;
        }

        .status-badge {
            font-size: 0.6rem;
            padding: 5px 12px;
            border-radius: 3px;
            text-transform: uppercase;
        }
        .status-active { background: rgba(0,255,0,0.2); color: #0f0; border: 1px solid #0f0; }
        .status-completed { background: rgba(0,0,255,0.2); color: #00f; border: 1px solid #00f; }
        .status-new { background: rgba(255,165,0,0.2); color: orange; border: 1px solid orange; animation: newPulse 1.5s infinite; }
        .status-failed { background: rgba(255,0,0,0.2); color: var(--quest-red); border: 1px solid var(--quest-red); }

        @keyframes newPulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } }

        /* Права панель (Статистика/Профіль) */
        .info-display-panel {
            background: var(--quest-panel);
            border: 1px solid var(--quest-border);
            padding: 30px;
            display: flex;
            flex-direction: column;
        }

        .stat-group {
            margin-bottom: 35px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 20px;
        }

        .stat-label { font-size: 0.6rem; color: var(--quest-cyan); opacity: 0.7; text-transform: uppercase; }
        .stat-value { font-family: 'Orbitron', sans-serif; font-size: 2.2rem; color: #fff; margin-top: 5px; }

        .profile-viewer {
            margin-top: auto;
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--quest-border);
        }

        .profile-avatar {
            width: 50px; height: 50px;
            border: 1px solid var(--quest-cyan);
            object-fit: cover;
        }

        .back-to-nexus {
            margin-top: 20px;
            text-align: center;
            color: var(--quest-red);
            text-decoration: none;
            font-size: 0.7rem;
            border: 1px solid var(--quest-red);
            padding: 15px;
            transition: 0.3s;
            text-transform: uppercase;
        }

        .back-to-nexus:hover { background: var(--quest-red); color: #000; box-shadow: 0 0 20px var(--quest-red); }
    </style>
</head>
<body>

<canvas id="grid-3d-canvas"></canvas>

<div class="quest-terminal">
    <header>
        <div class="sys-info">QUEST_LOG // SECTOR: DELTA-7</div>
        <div class="sys-clock" id="current-time">00:00:00</div>
        <div class="sys-info">DATA_STREAM: ACTIVE</div>
    </header>

    <aside class="sidebar-panel">
        <p style="font-size:0.6rem; color:var(--quest-cyan); opacity:0.8; margin-bottom:20px;">// QUEST_FILTERS</p>
        <div class="nav-category active" onclick="QuestLog.filter('news', this)">Усі Квести</div>
        <div class="nav-category" onclick="QuestLog.filter('update', this)">Активні</div>
        <div class="nav-category" onclick="QuestLog.filter('project', this)">Виконані</div>
        
        <a href="index.html" class="back-to-nexus">ПОВЕРНУТИСЬ ДО NEXUS</a>
    </aside>

    <main class="quest-log-feed" id="quest-feed"></main>

    <aside class="info-display-panel">
        <div class="stat-group">
            <p class="stat-label">Всього квестів</p>
            <div class="stat-value" id="total-quests">00</div>
        </div>
        
        <div class="stat-group">
            <p class="stat-label">Квестів виконано</p>
            <div class="stat-value" id="completed-quests">00</div>
        </div>

        <div class="profile-viewer">
            <img id="player-avatar" class="profile-avatar" src="">
            <div>
                <p id="player-name" style="font-weight: 700; font-size: 0.9rem;">PLAYER</p>
                <p style="font-size: 0.6rem; color: var(--quest-cyan);">RANK: PATHFINDER</p>
            </div>
        </div>
    </aside>
</div>

<script src="news-data.js"></script>

<script>
    // --- CANVAS 3D GRID BACKGROUND ---
    const canvas = document.getElementById('grid-3d-canvas');
    const ctx = canvas.getContext('2d');
    let gridPoints = [];
    const gridSize = 40; // Відстань між точками
    const numRows = 25;
    const numCols = 40;

    function initGrid() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        gridPoints = [];
        for (let r = 0; r < numRows; r++) {
            for (let c = 0; c < numCols; c++) {
                gridPoints.push({
                    x: c * gridSize + (canvas.width - numCols * gridSize) / 2,
                    y: r * gridSize + (canvas.height - numRows * gridSize) / 2,
                    ox: c * gridSize, // Оригінальні X для ефекту хвилі
                    oy: r * gridSize, // Оригінальні Y
                    z: 0, // Z-координата для 3D ефекту
                    color: `rgba(0, 242, 255, ${0.1 + Math.random() * 0.2})`
                });
            }
        }
    }

    function drawGrid() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        gridPoints.forEach((p, i) => {
            // Додамо невелике зміщення для ефекту "живої" сітки
            p.x = p.ox + Math.sin(Date.now() * 0.001 + i * 0.1) * 2;
            p.y = p.oy + Math.cos(Date.now() * 0.001 + i * 0.1) * 2;

            // Ефект "хвилі" від курсора
            const mouseX = QuestLog.mouseX || canvas.width / 2;
            const mouseY = QuestLog.mouseY || canvas.height / 2;
            const dist = Math.hypot(p.x - mouseX, p.y - mouseY);
            const maxDist = 300;
            const influence = Math.max(0, 1 - dist / maxDist);
            p.z = influence * 50; // Підняття точок

            const scale = 1 + p.z / 100; // Масштабування для 3D
            const alpha = 0.1 + influence * 0.4; // Яскравість

            ctx.fillStyle = `rgba(0, 242, 255, ${alpha})`;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 1 * scale, 0, Math.PI * 2);
            ctx.fill();

            // З'єднання лініями (лише сусідні)
            const neighbors = [
                gridPoints[i + 1], // Праворуч
                gridPoints[i + numCols] // Знизу
            ];

            neighbors.forEach(n => {
                if (n) {
                    const lineAlpha = Math.min(alpha, n.alpha) * 0.5;
                    ctx.strokeStyle = `rgba(0, 242, 255, ${lineAlpha})`;
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                    ctx.lineTo(n.x, n.y);
                    ctx.stroke();
                }
            });
        });
        requestAnimationFrame(drawGrid);
    }

    // --- TERMINAL LOGIC ---
    const QuestLog = {
        currentFilter: 'news',
        totalQuests: 0,
        completedQuests: 0,
        mouseX: 0,
        mouseY: 0,
        
        init() {
            const nick = localStorage.getItem('playerNick') || "Player";
            $('#player-name').text(nick.toUpperCase());
            $('#player-avatar').attr('src', `https://mc-heads.net/avatar/${nick}/64`);
            
            this.updateClock();
            setInterval(this.updateClock, 1000);
            
            this.render();
            window.addEventListener('resize', initGrid);
            document.addEventListener('mousemove', (e) => {
                this.mouseX = e.clientX;
                this.mouseY = e.clientY;
            });
            initGrid();
            drawGrid();
        },

        updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            $('#current-time').text(`${hours}:${minutes}:${seconds}`);
        },

        render() {
            const container = $('#quest-feed');
            container.empty();
            
            const data = (window.WHALES_STORAGE && window.WHALES_STORAGE.posts) ? window.WHALES_STORAGE.posts : [];
            let filtered = data;
            
            // Фільтрація
            if (this.currentFilter === 'update') {
                filtered = data.filter(post => post.type === 'news' && (Math.random() > 0.3)); // Симуляція активних
            } else if (this.currentFilter === 'project') {
                filtered = data.filter(post => post.type === 'project'); // Симуляція виконаних
            }

            this.totalQuests = data.length;
            this.completedQuests = data.filter(post => post.type === 'project').length; // Приклад: проекти як виконані

            $('#total-quests').text(this.totalQuests < 10 ? '0' + this.totalQuests : this.totalQuests);
            $('#completed-quests').text(this.completedQuests < 10 ? '0' + this.completedQuests : this.completedQuests);
            
            filtered.forEach((quest, index) => {
                const reward = Math.floor(Math.random() * 500) + 50; // Симуляція винагороди
                let statusClass = 'status-new'; // За замовчуванням
                if (quest.type === 'project') statusClass = 'status-completed';
                else if (Math.random() > 0.5) statusClass = 'status-active';

                container.append(`
                    <div class="quest-entry" style="animation-delay: ${index * 0.1}s">
                        <span class="quest-id">QUEST_ID: #${quest.id}</span>
                        <h2 class="quest-title">${quest.title.toUpperCase()}</h2>
                        <p class="quest-description">${quest.desc}</p>
                        <div class="quest-footer">
                            <div class="reward-info"><i class="fa-solid fa-gem" style="margin-right:8px;"></i>${reward} RESOURCES</div>
                            <span class="status-badge ${statusClass}">${statusClass.replace('status-', '')}</span>
                        </div>
                    </div>
                `);
            });
        },

        filter(type, el) {
            this.currentFilter = type;
            $('.nav-category').removeClass('active');
            $(el).addClass('active');
            this.render();
        }
    };

    $(document).ready(() => QuestLog.init());
</script>
</body>
</html>
